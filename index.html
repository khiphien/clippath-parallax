<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Parallax</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <div class="wrap">
        <svg class="svg-defs" xmlns="http://www.w3.org/2000/svg" width="100%" height="900" baseProfile="full" version="1.2">
            <defs>
                <clipPath id="clipping">
                    <path d="M0,0 l1000,180 v240 L0,500 z"></path>
                </clipPath>
            </defs>
            <g id="img">
<image width="100%" height="150%" y="-50%" xlink:href="https://dl.dropbox.com/s/4amw0vilxbty9tx/dove-2680487_1920.jpg?dl=0"></image>
          </g>
        </svg>
        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="600" baseProfile="full" version="1.2">
            <image width="100%" height="150%" y="-50%" xlink:href="https://dl.dropbox.com/s/4amw0vilxbty9tx/dove-2680487_1920.jpg?dl=0" preserveAspectRatio="xMidYMid slice" />
        </svg> -->
    </div>
    <script src="jquery.min.js"></script>
    <script src="common.js"></script>
    <script>
      window.appbrowser = {};

(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
            || window[vendors[x]+'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); },
                timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };

    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}());

var hasPrefix = function () {
    var styles = window.getComputedStyle(document.documentElement, ''),
        pre = (Array.prototype.slice
                .call(styles)
                .join('')
                .match(/-(moz|webkit|ms)-/) || (styles.OLink === '' && ['', 'o'])
        )[1],
        dom = ('WebKit|Moz|MS|O').match(new RegExp('(' + pre + ')', 'i'))[1];
    return {
        dom: dom,
        lowercase: pre,
        css: '-' + pre + '-',
        js: pre[0].toUpperCase() + pre.substr(1)
    };
};

/**
 * detect IE
 * returns version of IE or false, if browser is not Internet Explorer
 */
var detectIE = function() {
    var ua = window.navigator.userAgent;

    // Test values; Uncomment to check result â€¦

    // IE 10
    // ua = 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)';

    // IE 11
    // ua = 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko';

    // Edge 12 (Spartan)
    // ua = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36 Edge/12.0';

    // Edge 13
    // ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586';

    var msie = ua.indexOf('MSIE ');
    if (msie > 0) {
        // IE 10 or older => return version number
        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
    }

    var trident = ua.indexOf('Trident/');
    if (trident > 0) {
        // IE 11 => return version number
        var rv = ua.indexOf('rv:');
        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
    }

    var edge = ua.indexOf('Edge/');
    if (edge > 0) {
        // Edge (IE 12+) => return version number
        return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
    }

    // other browser
    return false;
};

var version = detectIE();

if (version === false) {
    window.appbrowser.name = false;
    window.appbrowser.version = false;
} else if (version >= 12) {
    window.appbrowser.name = 'Edge';
    window.appbrowser.version = version;
} else {
    window.appbrowser.name = 'IE';
    window.appbrowser.version = version;
}

window.appbrowser.prefix = hasPrefix();
      
        var SAMPLE = {
            init: function() {
                this.setParameters();
                this.setScrollPosition();
                this.setWidth();
                this.bindEvent();
            },
            setParameters: function() {
                this.$window = $(window);
                this.$container = $('.wrap');
                this.$svg = $('#clipping')
                this.$img = this.$container.find('image');
                this.translatePosition = 0;
            },
            bindEvent: function() {
                var myself = this;
                this.$window.on('resize', function(){
                    if(myself.timer !== false) {
                    clearTimeout(myself.timer);
                    }
                    myself.timer = setTimeout($.proxy(myself.setWidth, myself), 200);
                });

                this.$window.on('scroll', $.proxy(this.setScrollPosition, this));
            },
            setWidth: function() {
                var width = this.$window.width();
                if(width === this.windowWidth) return;
                this.windowWidth = this.$window.width();
                if(width <= 1000) width = 1000;
                this.$svg.find('path').attr('d','M0,0 l'+ width +',100 v240 L0,600 z');
            },
            setScrollPosition: function() {
                var scrollLength = this.$window.scrollTop(),
                    sectionNum = Math.ceil(scrollLength/this.containerHeight),
                    translatePosition = scrollLength;
                if(translatePosition >= this.containerHeight){
                    translatePosition -= this.containerHeight * (sectionNum-1);
                }
                //this.$img.css({'transform': 'translate(0, ' + translatePosition/2 + 'px)'});
                this.$img.css(window.appbrowser.prefix.css+'transform', 'translate3d(0px, '+translatePosition/2+'px, 0px');
            }
        }

        $(window).on('load',function(){
            SAMPLE.init();
        });
    </script>
  </body>
</html>
